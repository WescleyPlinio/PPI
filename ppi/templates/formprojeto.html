{% extends "base.html" %}
{% load static %}
{% block title %}Formulario{% endblock title %}
{% block conteudo %}

<!-- Estilos e scripts necessários para django-select2 -->
<link href="{% static 'django_select2/css/select2.min.css' %}" rel="stylesheet">
<script src="{% static 'django_select2/js/select2.min.js' %}"></script>

<div class="container custom-container mb-5 py-3">
  <h1 class="text-white text-center" style="font-size: 3.5em;">
    {% if projeto %}Edite seu {% else %}Adicione seu {% endif %}<a class="roxinho">projeto aqui!</a>
  </h1>
</div>

<div class="container-fluid blueback py-5">
  <div class="form-container mx-auto custom-container">
    <form action="" method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="row g-0">
        <div class="col-md-6 p-3">
          <!-- Título -->
          <div class="form-group">
            <label for="id_titulo">Título:</label>
            {{ form.titulo}}
          </div>

          <!-- Resumo -->
          <div class="form-group">
            <label for="id_resumo">Resumo:</label>
            {{ form.resumo }}
          </div>

          <!-- Objetivo -->
          <div class="form-group">
            <label for="id_objetivo">Objetivo:</label>
            {{ form.objetivo }}
          </div>

          <!-- PDF -->
          <div class="form-group">
            <label for="id_pdf">Arquivo PDF:</label>
            {{ form.pdf }}
          </div>
        </div>

        <div class="col-md-6 p-3">
          <!-- Capa do Projeto -->
          <div class="form-group">
            <label for="id_capa">Capa do projeto:</label>
            {{ form.capa }}
          </div>

          <!-- Fotos do Projeto -->
          <div class="form-group">
            <label for="images">Imagens do projeto:</label>
            {{ form.imagens }}
          </div>

          <!-- Alunos -->
          <div class="form-group">
            <label for="id_alunos">Alunos:</label>
            <select class="form-control blueback" id="alunos" name="alunos" multiple class="form-control select2">
              {% for aluno in alunos %}
            <option value="{{ aluno.id }}">{{ aluno.nome }}</option>
        {% endfor %}
            </select>
          </div>

          <!-- Orientadores -->
          <div class="form-group">
            <label for="id_orientadores">Orientador(es):</label>
            <select class="form-control blueback" id="orientadores" name="orientadores" multiple class="form-control">
              {% for orientador in orientadores %}
            <option value="{{ orientador.id }}">{{ orientador.nome }}</option>
        {% endfor %}
            </select>
          </div>

          <script src="{% static 'django_select2/js/select2.min.js' %}"></script>
<script>
    $(document).ready(function() {
        $('.select2').select2();
    });
</script>

          <!-- Curso -->
          <div class="form-group">
            <label for="course">Curso:</label>
            {{ form.curso }}
          </div>

          <!-- Palavras-Chave -->
          <div class="form-group">
            <label for="keywords">Palavras-Chave (separadas por vírgula):</label>
            {{ form.palavras_chave }}
          </div>

          <!-- Botão de Submissão -->
          <div class="form-group mt-4">
            <button class="btn btn-primary" type="submit">{% if projeto %}Salvar Alterações{% else %}Adicionar{% endif %}</button></button>
            {% if projeto %}
                <a href="{% url 'verperfil' %}" class="btn btn-secondary">Cancelar</a>
            {% endif %}
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Inicializa o Select2 para os campos de alunos e professores
    $('#Usuario1').select2({
      placeholder: "Digite o nome ou e-mail do aluno",
      ajax: {
        url: "{% url 'aluno-search' %}",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term
          };
        },
        processResults: function (data) {
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 1
    });

    $('#Usuario2').select2({
      placeholder: "Digite o nome ou e-mail do professor",
      ajax: {
        url: "{% url 'professor-search' %}",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term
          };
        },
        processResults: function (data) {
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 1
    });
  });
</script>

{% endblock conteudo %}
